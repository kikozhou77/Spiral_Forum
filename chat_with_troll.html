<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8"><title>与 sohnwhnalqq9912_xlk 的对话</title><link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <header>...</header>
        <main>
            <div class="chat-layout">
                <div class="contact-list">...</div>
                <div class="chat-window">
                    <div class="chat-header">sohnwhnalqq9912_xlk</div>
                    <div class="chat-messages" id="message-container"></div>
                    <!-- 新增的输入区域 -->
                    <div class="chat-input-area">
                        <input type="text" id="fake-input" class="chat-input" placeholder="输入消息..." readonly>
                        <button id="send-btn" class="send-button disabled" disabled>↑</button>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="typeit.min.js"></script>
    <script>
        const messageContainer = document.getElementById('message-container');
        const fakeInput = document.getElementById('fake-input');
        const sendBtn = document.getElementById('send-btn');
        let currentStep = 0;
        let isTyping = false; // 防止在打字时重复触发

        const script = [
            { type: 'received', text: '像你这种阴暗老鼠就只敢躲在电脑后面，一定丑得惊人，在现实里活得很可怜吧。' },
            { type: 'sent-ime', pinyin: 'xìn bu xìn wǒ bǎ nǐ kāi le', text: '信不信我把你开了。' },
            { type: 'received', text: '刚注册的新号，你开。' },
            { type: 'pause', text: '--- 切换到黑客操作界面 ---' }, 
            { type: 'sent', text: '张伟' },
            { type: 'sent', text: '23岁，家住幸福小区3栋401' },
            { type: 'sent', text: '你昨天刚买的螺蛳粉，今天应该到了吧？' },
            { type: 'sent', text: '你最近总是在看二手车网站，想买高尔夫？' },
            { type: 'received', text: '大哥我错了！！！' },
            { type: 'received', text: '求求你别发了，我给你磕头了！' }
        ];

        function nextStep() {
            if (currentStep >= script.length || isTyping) return;

            isTyping = true;
            const step = script[currentStep];

            if (step.type === 'pause') {
                console.log(step.text);
                isTyping = false;
                currentStep++;
                return;
            }

            // 如果是对方消息，直接显示在聊天记录里
            if (step.type === 'received') {
                showInChat(step.text, 'received', () => isTyping = false);
                currentStep++;
            } 
            // 如果是小A的消息
            else if (step.type.startsWith('sent')) {
                // 1. 在输入框里模拟打字
                simulateTypingInInput(step, () => {
                    // 2. 打完字后，将内容“发送”到聊天记录
                    const textToSend = fakeInput.value;
                    fakeInput.value = ''; // 清空输入框
                    sendBtn.classList.add('disabled');
                    sendBtn.disabled = true;
                    showInChat(textToSend, 'sent', () => isTyping = false);
                    currentStep++;
                });
            }
        }

        // 在输入框里模拟打字
        function simulateTypingInInput(step, onComplete) {
            sendBtn.classList.add('disabled');
            sendBtn.disabled = true;

            const inputTypeit = new TypeIt('#fake-input', {
                speed: 100, lifeLike: true,
                afterComplete: () => {
                    sendBtn.classList.remove('disabled');
                    sendBtn.disabled = false;
                    setTimeout(onComplete, 300); // 模拟发送前的短暂延迟
                }
            });

            if (step.type === 'sent-ime') {
                inputTypeit
                    .type(step.pinyin, { instant: true }) // 拼音可以瞬间出现
                    .pause(500)
                    .delete(step.pinyin.length, { instant: true })
                    .type(step.text);
            } else {
                inputTypeit.type(step.text);
            }
            inputTypeit.go();
        }

        // 在聊天记录里显示消息
        function showInChat(text, type, onComplete) {
            const bubble = document.createElement('div');
            bubble.className = `message-bubble msg-${type}`;
            const elementId = `msg-${Date.now()}`;
            bubble.id = elementId;
            
            messageContainer.appendChild(bubble);
            messageContainer.scrollTop = messageContainer.scrollHeight;

            new TypeIt(`#${elementId}`, {
                strings: text,
                speed: 10, // 发送后可以快速显示
                instant: true, // 或者直接显示
                afterComplete: (instance) => {
                    instance.destroy();
                    if(onComplete) onComplete();
                }
            }).go();
        }

        document.body.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                nextStep();
            }
        });
    </script>
</body>
</html>
