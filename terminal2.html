<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Terminal_a_private</title>
  <link rel="stylesheet" href="terminal_logic.css">
  <script src="typeit.min.js"></script>
</head>
<body>
  <div id="terminal"></div>

  <script>
    const terminal = document.getElementById("terminal");

    // 生成乱码段
    function generateNoise(length = 40) {
      const density = Math.random() * 0.1 + 0.9; // 80% - 100% 是乱码
      return Array.from({ length }, () =>
        Math.random() < density
          ? String.fromCharCode(33 + Math.floor(Math.random() * 94))
          : " "
      ).join("");
    }


    const insertImageSection = () => {
      // 1. 加入前部乱码
      const noiseLines = Math.floor(Math.random() * 3) + 5;
      for (let i = 0; i < noiseLines; i++) {
        const noise = generateNoise(50 + Math.floor(Math.random() * 20));
        const line = document.createElement("div");
        line.className = "chat-line";
        line.textContent = noise;
        terminal.appendChild(line);
      }
    
      // 2. 加入照片链接
      const links = ["photo1.jpg", "photo2.jpg"];
      links.forEach(filename => {
        const line = document.createElement("div");
        line.className = "chat-line";
        line.innerHTML = `${generateNoise(12)} >>> [照片] <a href="terminal_image/${filename}" target="_blank" style="color:white;text-decoration:underline;">${filename}</a> ${generateNoise(12)}`;
        terminal.appendChild(line);
      });
    
      // 3. 加入后部乱码（❗改名避免冲突）
      const extraNoiseLines = Math.floor(Math.random() * 3) + 5;
      for (let i = 0; i < extraNoiseLines; i++) {
        const noise = generateNoise(50 + Math.floor(Math.random() * 20));
        const line = document.createElement("div");
        line.className = "chat-line";
        line.textContent = noise;
        terminal.appendChild(line);
      }
    
      terminal.scrollTop = terminal.scrollHeight;
    };



    // 聊天内容
    const messages = [
      { sender: "梦君", text: "这份实验数据我觉得没问题了，我在邮箱上发你了。" },
      { sender: "小芝士", text: "收到啦ovo师姐你太强了，这个实验我一直完成不了" },
      { sender: "梦君", text: "其实注意变量控制就可以了，别的地方你都完成得很好。" },
      { sender: "梦君", text: "小芝，你和你男朋友在一起多久了？" },
      { sender: "小芝士", text: "已经分手啦TvT" },
      { sender: "梦君", text: "啊？为什么呀？" },
      { sender: "小芝士", text: "因为异地恋嘛，要克服的困难比想象中要多很多。" },
      { sender: "梦君", text: "你们以前是因为什么在一起的呢？" },
      { sender: "小芝士", text: "从前是大学同学，经常一起做小组作业，自然而然就熟啦。" },
      { sender: "梦君", text: "这样的啊……" },
      { sender: "小芝士", text: "师姐你怎么突然还关心起恋爱来了？老实交代你是不是有情况！" },
      { sender: "梦君", text: "这种事情的时候怎么会这么敏锐？" },
      { sender: "小A", text: "好恶心，最讨厌看别人谈恋爱了。" },
      { sender: "小芝士", text: "？？？？真的啊！！" },
      { sender: "小芝士", text: "是谁！" },
      { sender: "小芝士", text: "可我最近没有看见师姐你和谁走得近呀ovo" },
      { sender: "梦君", text: "嗯……" },
      { sender: "梦君", text: "没在一起" },
      { sender: "小芝士", text: "异地恋？!" },
      { sender: "梦君", text: "差不多吧。" },
      { sender: "小芝士", text: "天啊……师姐你不要把我前面的话放心上。其实只要两个人有心，就没什么不能克服的。" },
      { sender: "小芝士", text: "师姐你最近几天怎么都没来实验室" },
      { sender: "小芝士", text: "师姐你生病了吗？" },
      { sender: "小芝士", text: "师姐那个……是怎么回事？" },
      { sender: "小芝士", text: "师姐你别太伤心了……虽然不了解具体发生了什么，但是我永远支持你！" },
      { sender: " ", text: "?kl////203.0.113.114" },
      { sender: ">>>IP地址解析定位中!!!waiting::：", text: "某某市某某垃圾场" },
    ];

    let index = 0;

   function printNextMessage() {
    if (index >= messages.length) {
      setTimeout(openRepairWindow, 1000);
      return;
    }
  
    const noiseLength = Math.floor(Math.random() * 30) + 10;
    const prefixNoise = generateNoise(noiseLength);
    const suffixNoise = generateNoise(noiseLength);
  
    const container = document.createElement("div");
    container.className = "chat-line";
  
    const middleContent = `<span class="sender">${messages[index].sender}：</span>${messages[index].text}`;
    const insertAt = Math.floor(Math.random() * (prefixNoise.length + 1));
    
    // 拼接：在 prefixNoise 中插入 middleContent，然后接 suffixNoise
    const noisyLine =
      prefixNoise.slice(0, insertAt) +
      middleContent +
      prefixNoise.slice(insertAt) +
      suffixNoise;
  
    container.innerHTML = noisyLine;
    terminal.appendChild(container);
    terminal.scrollTop = terminal.scrollHeight;
  
    index++;
    setTimeout(printNextMessage, 600);
  }


    function openRepairWindow() {
      window.open('repair.html', '_blank', 'width=640,height=400');
    }

    // 打印初始化提示 + 插入图 + 开始聊天
    new TypeIt("#terminal", {
      speed: 20,
      cursorChar: "_",
      startDelay: 500
    })
      .type(">>> 已进入用户21的系统")
      .break().pause(400)
      .type(">>> 尝试恢复照片中...")
      .pause(1000)
      .exec(insertImageSection)
      .break()
      .type(">>> 尝试恢复微信数据：...")
      .pause(800)
      .exec(() => printNextMessage())
      .go();
  </script>
</body>
</html>
