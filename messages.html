<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æˆ‘çš„ä¿¡æ¯ - èºæ—‹è®ºå›</title>
  <link rel="stylesheet" href="style.css">
  <style>
    .chat-divider {
      border: none;
      border-top: 1px solid var(--border-color);
      margin: 16px 0;
      opacity: 0.4;
    }
    .delete-button {
      background: none;
      border: none;
      color: var(--text-muted);
      font-size: 1.1em;
      cursor: pointer;
      margin-left: 8px;
      padding: 4px;
      transition: color 0.2s ease;
    }
    .delete-button:hover {
      color: #dc3545;
    }
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo">èºæ—‹è®ºå›</div>
    <div>ç”¨æˆ·å°A | <a href="messages.html">ç§ä¿¡<span id="msg-badge" class="notification-badge">99+</span></a></div>
  </header>

  <nav>
    <a href="index.html">é¦–é¡µ</a>
    <a href="my_follows.html">æˆ‘çš„å…³æ³¨</a>
    <a href="my_profile.html">æˆ‘çš„ä¸»é¡µ</a>
    <a href="messages.html" class="active">æˆ‘çš„ä¿¡æ¯</a>
    <a href="post_detail.html" class="post-button">æˆ‘è¦å‘å¸–ï¼</a>
  </nav>

  <main>
    <div class="chat-layout">
      <div class="contact-list" id="contact-list-container">
        <h2>ç§ä¿¡åˆ—è¡¨ <button onclick="alert('å·²å…¨éƒ¨è®¾ä¸ºå·²è¯»ï¼')">ä¸€é”®å·²è¯»</button></h2>
        <div class="contact-item" data-contact-id="troll" onclick="loadChat('troll')">
          <img src="https://via.placeholder.com/48/000/FFF?text=å‰‘" class="contact-avatar">
          <div class="contact-info">
            <div class="name">sohnwhnalqq9912_xlk</div>
            <div class="preview">...</div>
          </div>
        </div>
        <div class="contact-item" data-contact-id="user21" onclick="loadChat('user21')">
          <img src="https://via.placeholder.com/48/ccc/000?text=?" class="contact-avatar">
          <div class="contact-info">
            <div class="name">ç”¨æˆ·21</div>
            <div class="preview">...</div>
          </div>
        </div>
      </div>

      <div id="chat-content-area" class="chat-window" style="align-items: center; justify-content: center;">
        <h2 style="color: #999;">ç‚¹å‡»å·¦ä¾§è”ç³»äººå¼€å§‹å¯¹è¯</h2>
      </div>
    </div>
  </main>
</div>

<script>
const chatData = {
  troll: {
    name: 'sohnwhnalqq9912_xlk',
    profileLink: '#',
    replies: [
      'åƒä½ è¿™ç§é˜´æš—è€é¼ å°±åªæ•¢èº²åœ¨ç”µè„‘åé¢ï¼Œä¸€å®šä¸‘å¾—æƒŠäººï¼Œåœ¨ç°å®é‡Œæ´»å¾—å¾ˆå¯æ€œå§ã€‚',
      'åˆšæ³¨å†Œçš„æ–°å·ï¼Œä½ å¼€ã€‚',
      'æˆ‘ä¼šè®©ä½ åæ‚”çš„ã€‚',
      'ä¸ä¿¡ä½ å¯ä»¥è¯•è¯•ã€‚'
    ]
  },
  user21: {
    name: 'ç”¨æˆ·21',
    profileLink: 'user21_profile.html',
    replies: [
      'å¾ˆæŠ±æ­‰ï¼Œå†’æ˜§æ‰“æ‰°â€¦â€¦æˆ‘å¤±å¿†äº†ï¼Œç›®å‰åªæœ‰ä¸€å°ç”µè„‘ï¼Œæˆ‘æƒ³ä»ç”µè„‘é‡Œæ‰¾åˆ°ä¸€äº›çº¿ç´¢ã€‚',
      'æˆ‘æ— æ³•å»åŒ»é™¢ã€‚',
      'æŠ±æ­‰ï¼Œæ¯•ç«Ÿè¿™æ˜¯ä¸€å°è¢«æ ¼å¼åŒ–çš„ç”µè„‘ï¼Œæˆ‘æƒ³è¿™ä¸ªè¯·æ±‚ç¡®å®å¤ªå¼ºäººæ‰€éš¾äº†ã€‚',
      'è°¢è°¢â€¦â€¦é‚£å°±æ‹œæ‰˜æ‚¨äº†ï¼',
      'æˆ‘å¯ä»¥æŠŠæˆ‘çš„ç”µè„‘æƒé™å®Œå…¨å¯¹æ‚¨æ•å¼€ã€‚'
    ]
  }
};

const chatHistory = {};
const chatState = {};
let activeContactId = null;

function loadChat(contactId) {
  activeContactId = contactId;
  const data = chatData[contactId];
  if (!data) return;

  const contentArea = document.getElementById('chat-content-area');
  contentArea.innerHTML = '';

  const header = document.createElement('div');
  header.classList.add('chat-header');
  header.innerHTML = `<a href="${data.profileLink}">${data.name}</a>
    <button class="delete-button" onclick="clearChat('${contactId}')" title="æ¸…ç©ºèŠå¤©">ğŸ—‘</button>`;

  const messageBox = document.createElement('div');
  messageBox.classList.add('chat-messages');
  messageBox.id = 'message-container';

  contentArea.appendChild(header);
  contentArea.appendChild(messageBox);

  (chatHistory[contactId] || []).forEach(msg => {
    const bubble = document.createElement('div');
    bubble.className = `message-bubble msg-${msg.type}`;
    bubble.textContent = msg.text;
    messageBox.appendChild(bubble);
  });

  messageBox.scrollTop = messageBox.scrollHeight;

  const inputArea = document.createElement('div');
  inputArea.className = 'chat-input-area';
  inputArea.innerHTML = `
    <input type="text" id="real-input" class="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯åæŒ‰ Enter...">
    <button id="send-btn" class="send-button">â†‘</button>
  `;
  contentArea.appendChild(inputArea);

  document.getElementById('send-btn').addEventListener('click', handleUserMessage);
  document.getElementById('real-input').addEventListener('keydown', e => {
    if (e.key === 'Enter') handleUserMessage();
  });

  if (!chatHistory[contactId]) chatHistory[contactId] = [];
  chatState[contactId] = { shouldInsertDivider: true };

  if (chatHistory[contactId].length === 0) {
    simulateBotReply(contactId);
  }
}

function insertDividerIfNeeded() {
  const state = chatState[activeContactId];
  if (state && state.shouldInsertDivider) {
    const divider = document.createElement('hr');
    divider.className = 'chat-divider';
    document.getElementById('message-container').appendChild(divider);
    state.shouldInsertDivider = false;
  }
}

function handleUserMessage() {
  const input = document.getElementById('real-input');
  const text = input.value.trim();
  if (!text) return;
  input.value = '';

  insertDividerIfNeeded();

  const bubble = document.createElement('div');
  bubble.className = 'message-bubble msg-sent';
  bubble.textContent = text;
  const msgBox = document.getElementById('message-container');
  msgBox.appendChild(bubble);
  msgBox.scrollTop = msgBox.scrollHeight;

  chatHistory[activeContactId].push({ text, type: 'sent' });
  updatePreview(activeContactId, text);

  simulateBotReply(activeContactId);
}

function simulateBotReply(contactId) {
  const replies = chatData[contactId]?.replies || [];
  const history = chatHistory[contactId];
  const replyIndex = history.filter(m => m.type === 'received').length;
  if (replyIndex >= replies.length) return;

  setTimeout(() => {
    if (activeContactId !== contactId) return;
    insertDividerIfNeeded();

    const text = replies[replyIndex];
    const bubble = document.createElement('div');
    bubble.className = 'message-bubble msg-received';
    bubble.textContent = text;
    const msgBox = document.getElementById('message-container');
    msgBox.appendChild(bubble);
    msgBox.scrollTop = msgBox.scrollHeight;

    chatHistory[contactId].push({ text, type: 'received' });
    updatePreview(contactId, text);
  }, 1000);
}

function updatePreview(contactId, text) {
  const contactItem = document.querySelector(`.contact-item[data-contact-id="${contactId}"]`);
  if (contactItem) {
    const previewEl = contactItem.querySelector('.preview');
    previewEl.textContent = text.substring(0, 20) + '...';
  }
}

function clearChat(contactId) {
  if (confirm('ç¡®å®šè¦æ¸…ç©ºå½“å‰èŠå¤©è®°å½•å—ï¼Ÿ')) {
    chatHistory[contactId] = [];
    loadChat(contactId);
  }
}

document.querySelectorAll('.contact-item').forEach(item => {
  const cid = item.dataset.contactId;
  const data = chatData[cid];
  if (data && data.replies.length) {
    const previewEl = item.querySelector('.preview');
    previewEl.textContent = data.replies[0].substring(0, 20) + '...';
  }
});
</script>
</body>
</html>
