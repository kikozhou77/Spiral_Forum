<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Terminal_a_private</title>
  <link rel="stylesheet" href="terminal_logic.css">
  <script src="typeit.min.js"></script>
</head>
<body>
  <div id="terminal"></div>

  <script>
    const terminal = document.getElementById("terminal");

    function generateNoise(length = 40) {
      const density = Math.random() * 0.1 + 0.9;
      return Array.from({ length }, () =>
        Math.random() < density
          ? String.fromCharCode(33 + Math.floor(Math.random() * 94))
          : " "
      ).join("");
    }

    const insertPreviewSection = () => {
      const noiseLinesBefore = Math.floor(Math.random() * 3) + 4;
      for (let i = 0; i < noiseLinesBefore; i++) {
        const noise = generateNoise(50 + Math.floor(Math.random() * 30));
        const line = document.createElement("div");
        line.className = "chat-line";
        line.textContent = noise;
        terminal.appendChild(line);
      }

      const line = document.createElement("div");
      line.className = "chat-line";
      line.innerHTML = `${generateNoise(8)} >>> [头像更新] user21_new.jpg <span style="color:white">（已替换完成）</span> ${generateNoise(8)}`;
      terminal.appendChild(line);

      const noiseLinesAfter = Math.floor(Math.random() * 3) + 4;
      for (let i = 0; i < noiseLinesAfter; i++) {
        const noise = generateNoise(50 + Math.floor(Math.random() * 30));
        const line = document.createElement("div");
        line.className = "chat-line";
        line.textContent = noise;
        terminal.appendChild(line);
      }

      terminal.scrollTop = terminal.scrollHeight;
    };

    const logs = [
      ">>> 正在连接用户21的终端...",
      ">>> 进入高级控制权限...",
      ">>> 读取用户资料...",
      ">>> 替换头像指令已发出：avatar-change user21 ./avatar_new.jpg",
      "✔ 身份认证成功 √",
      "✔ 系统校验通过，准备写入数据...",
      ">>> 写入头像文件中...",
      ">>> 新头像路径：./avatar_new.jpg",
      ">>> 系统确认替换请求",
      "✔ 用户21头像修改成功 √",
      ">>> 显示头像确认记录..."
    ];

    let index = 0;

    function printNextLine() {
      if (index >= logs.length) {
        setTimeout(insertPreviewSection, 500);
        return;
      }
      const noiseBefore = generateNoise(Math.floor(Math.random() * 12));
      const noiseAfter = generateNoise(Math.floor(Math.random() * 16));

      const line = document.createElement("div");
      line.className = "chat-line";
      line.innerHTML = `${noiseBefore} ${logs[index]} ${noiseAfter}`;
      terminal.appendChild(line);
      terminal.scrollTop = terminal.scrollHeight;
      index++;
      setTimeout(printNextLine, 500);
    }

    new TypeIt("#terminal", {
      speed: 20,
      cursorChar: "_",
      startDelay: 400
    })
      .exec(() => printNextLine())
      .go();
  </script>
</body>
</html>
