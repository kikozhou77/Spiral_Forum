<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Terminal_a_private</title>
  <link rel="stylesheet" href="terminal_logic.css" />
  <script src="typeit.min.js"></script>
  <style>
    body {
      background-color: black;
      color: white;
      font-family: 'Courier New', monospace;
      padding: 20px;
    }
    .avatar-preview {
      margin-top: 20px;
      border: 1px dashed white;
      padding: 10px;
      display: inline-block;
      color: white;
    }
  </style>
</head>
<body>
  <div id="terminal"></div>

  <script>
    const terminal = document.getElementById("terminal");

    const commands = [
      ">>> [G^1@#] 初始化终端链接...",
      ">>> sudo avatar-change user21 ./avatar_new.jpg",
      "~$@#&!Q*! 验证权限中...",
      "✔ 用户身份认证成功",
      ">>> 系统校验中... 3x!V#12@%",
      "@#klsD*(#@! 上传文件中",
      "✔ 正在上传新头像...",
      "Zx*21!@&>>✔ 用户21头像修改成功 √",
      ">>> 显示新头像预览："
    ];

    function generateNoise(length = 60) {
      const density = Math.random() * 0.2 + 0.8;
      return Array.from({ length }, () =>
        Math.random() < density
          ? String.fromCharCode(33 + Math.floor(Math.random() * 94))
          : " "
      ).join("");
    }

    function typeNext(instance, i = 0) {
      if (i >= commands.length) {
        return instance.exec(() => {
          const div = document.createElement("div");
          div.className = "avatar-preview";
          div.innerText = "[头像预览] user21_new.jpg → ✔ 已更新 (模拟)";
          terminal.appendChild(div);
          terminal.scrollTop = terminal.scrollHeight;
          return instance;
        });
      }

      const line = commands[i];
      const noiseBefore = generateNoise(Math.floor(Math.random() * 20));
      const noiseAfter = generateNoise(Math.floor(Math.random() * 20));

      return instance
        .type(noiseBefore + " " + line + " " + noiseAfter)
        .break()
        .pause(300)
        .exec(() => {
          terminal.scrollTop = terminal.scrollHeight;
          typeNext(instance, i + 1);
          return instance;
        });
    }

    new TypeIt("#terminal", {
      speed: 20,
      cursorChar: "_",
      lifeLike: false,
      startDelay: 300
    })
    .exec((instance) => {
      typeNext(instance);
      return instance;
    })
    .go();
  </script>
</body>
</html>
